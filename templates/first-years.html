<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>First-Years</title>
        <link href="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/style.min.css" rel="stylesheet" />
        <link href="{{ url_for('static', filename='css/styles.css') }}" rel="stylesheet" />
        <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
        <link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" rel="stylesheet" />
        <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
    </head>
    <body class="sb-nav-fixed">
        <div id="layoutSidenav">
            <div id="layoutSidenav_nav">
                <nav class="sb-sidenav accordion sb-sidenav-light" id="sidenavAccordion">

                    <div class="sidebar-logo-container" style="text-align: center; padding: 1.5rem 0;">
                        <a href="{{ url_for('main.groups') }}">
                            <img src="{{ url_for('static', filename='img/colby_logo.png') }}" alt="Colby logo" style="height: 50px; width: auto;">
                        </a>
                    </div>

                    <div class="sb-sidenav-menu">
                        <div class="nav">
                            <a class="nav-link" href="{{ url_for('main.trips') }}">
                                <div class="sb-nav-link-icon"><i class="fas fa-route"></i></div>
                                Trips
                            </a>
                            <a class="nav-link" href="{{ url_for('main.first_years') }}">
                                <div class="sb-nav-link-icon"><i class="fas fa-user-plus"></i></div>
                                First Years
                            </a>
                            <a class="nav-link" href="{{ url_for('main.groups') }}">
                                <div class="sb-nav-link-icon"><i class="fas fa-users"></i></div>
                                Groups
                            </a>
                        </div>
                    </div>

                    <div class="sb-sidenav-footer">
                        <a class="nav-link" href="{{ url_for('main.settings') }}">
                            <div class="sb-nav-link-icon"><i class="fas fa-cog"></i></div>
                            Settings
                        </a>
                    </div>
                </nav>
            </div>
            <div id="layoutSidenav_content">
                <main>
                    <div class="container-fluid px-4">
                        <h1 class="mt-4">First-Years</h1>

                        <!-- Flash Messages for First-Years Page -->
                        {% with messages = get_flashed_messages(with_categories=true) %}
                            {% if messages %}
                                {% for category, message in messages %}
                                    {% if 'Student' in message or 'Error' in message or 'CSV' in message %}
                                        <div class="alert alert-{{ 'danger' if category == 'danger' else 'success' if category == 'success' else 'warning' if category == 'warning' else 'info' }} alert-dismissible fade show" role="alert">
                                            {{ message }}
                                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                        </div>
                                    {% endif %}
                                {% endfor %}
                            {% endif %}
                        {% endwith %}
                        <div class="action-row">
                            <button class="btn btn-navy" data-bs-toggle="modal" data-bs-target="#uploadCSVModal">Upload CSV</button>
                            <button class="btn btn-navy" type="button" data-bs-toggle="modal" data-bs-target="#addStudentModal">
                                <i class="fas fa-plus me-1"></i> Add a student
                            </button>
                            <button class="btn btn-navy" type="button" data-bs-toggle="modal" data-bs-target="#removeStudentModal">- Remove</button>
                            <button class="btn btn-navy" data-bs-toggle="modal" data-bs-target="#moveStudentModal">Move Students</button>
                            <button class="btn btn-navy" data-bs-toggle="modal" data-bs-target="#swapStudentsModal">Swap Students</button>
                        </div>
                        <div class="card mb-4">
                            <div class="card-header">
                                <i class="fas fa-table me-1"></i>
                                First-Years
                            </div>
                            <div class="card-body">
                                <table id="datatablesSimple">
                                    <thead>
                                        <tr>
                                            <th>Student ID</th>
                                            <th>Email</th>
                                            <th>First Name</th>
                                            <th>Last Name</th>
                                            <th>Trip</th>
                                            <th>Preference #1</th>
                                            <th>Preference #2</th>
                                            <th>Preference #3</th>
                                            <th>Dorm</th>
                                            <th>Athletic Team</th>
                                            <th>Gender</th>
                                            <th>POC?</th>
                                            <th>FLI International?</th>
                                            <th>Hometown</th>
                                            <th>Water Comfort</th>
                                            <th>Tent Comfort</th>
                                            <th>Notes</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for student in students %}
                                        <tr>
                                            <td>{{ student.student_id }}</td>
                                            <td>{{ student.email }}</td>
                                            <td>{{ student.first_name }}</td>
                                            <td>{{ student.last_name }}</td>
                                            <td>{{ student.trip.trip_name if student.trip else '' }}</td>
                                            <td>{{ student.trip_pref_1 or '' }}</td>
                                            <td>{{ student.trip_pref_2 or '' }}</td>
                                            <td>{{ student.trip_pref_3 or '' }}</td>
                                            <td>{{ student.dorm or '' }}</td>
                                            <td>{{ student.athletic_team or 'No' }}</td>
                                            <td>{{ student.gender or '' }}</td>
                                            <td>{{ 'Yes' if student.poc else 'No' }}</td>
                                            <td>{{ 'Yes' if student.fli_international else 'No' }}</td>
                                            <td>{{ student.hometown or '' }}</td>
                                            <td>{{ student.water_comfort or '' }}</td>
                                            <td>{{ student.tent_comfort or '' }}</td>
                                            <td>{{ student.notes or 'N/A' }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>

        <div class="modal fade" id="addStudentModal" tabindex="-1" aria-labelledby="addStudentModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addStudentModalLabel">Add New Student</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <form action="{{ url_for('main.add_student') }}" method="POST">
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="student_id" class="form-label">Student ID*</label>
                                    <input type="text" class="form-control" id="student_id" name="student_id" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="email" class="form-label">Email*</label>
                                    <input type="email" class="form-control" id="email" name="email" required>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="first_name" class="form-label">First Name*</label>
                                    <input type="text" class="form-control" id="first_name" name="first_name" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="last_name" class="form-label">Last Name*</label>
                                    <input type="text" class="form-control" id="last_name" name="last_name" required>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="trip_pref_1" class="form-label">Trip Pref 1</label>
                                <select id="trip_pref_1" name="trip_pref_1" class="form-label">
                                    <option value="" disabled selected>Select an option</option>
                                    {% for tripType in unique_trip_types %}
                                        <option value="{{ tripType }}">{{ tripType }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="trip_pref_2" class="form-label">Trip Pref 2</label>
                                <select id="trip_pref_2" name="trip_pref_2" class="form-label">
                                    <option value="" disabled selected>Select an option</option>
                                    {% for tripType in unique_trip_types %}
                                        <option value="{{ tripType }}">{{ tripType }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="trip_pref_3" class="form-label">Trip Pref 3</label>
                                <select id="trip_pref_3" name="trip_pref_3" class="form-label">
                                    <option value="" disabled selected>Select an option</option>
                                    {% for tripType in unique_trip_types %}
                                        <option value="{{ tripType }}">{{ tripType }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                             <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="dorm" class="form-label">Dorm</label>
                                    <input type="text" class="form-control" id="dorm" name="dorm">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="athletic_team" class="form-label">Athletic Team</label>
                                    <input type="text" class="form-control" id="athletic_team" name="athletic_team">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="hometown" class="form-label">Hometown</label>
                                    <input type="text" class="form-control" id="hometown" name="hometown">
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="assigned-trip" class="form-label">Assigned Trip</label>
                                <select id="assigned-trip" name="assigned-trip" class="form-label">
                                    <option value="" disabled selected>Select an option</option>
                                    {% for trip in trips %}
                                        <option value="{{ trip.id }}">{{ trip.trip_name }} ({{ trip.trip_type }})</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="water-comfort" class="form-label">Water Comfort</label>
                                    <select id="water-comfort" name="water_comfort" class="form-label">
                                        <option value="" disabled selected>Select an option</option>
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                        <option value="5">5</option>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="tent-comfort" class="form-label">Tent Comfort</label>
                                    <select id="tent-comfort" name="tent_comfort" class="form-label">
                                        <option value="" disabled selected>Select an option</option>
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                        <option value="5">5</option>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="gender" class="form-label">Gender</label>
                                    <select id="gender" name="gender" class="form-label">
                                        <option value="" disabled selected>Select an option</option>
                                        <option value="female">Female</option>
                                        <option value="male">Male</option>
                                        <option value="nonbinary">Non-Binary</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <div class="form-check mt-4">
                                        <input class="form-check-input" type="checkbox" value="true" id="poc" name="poc">
                                        <label class="form-check-label" for="poc">
                                            POC
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <div class="form-check mt-4">
                                        <input class="form-check-input" type="checkbox" value="true" id="fli_international" name="fli_international">
                                        <label class="form-check-label" for="fli_international">
                                            FLI International
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="notes" class="form-label">Notes</label>
                                <textarea class="form-control" id="notes" name="notes" rows="3"></textarea>
                            </div>
                            <small class="text-muted">Fields marked with * are required.</small>
                        </div>
                        <div class="modal-footer">
                            <button type="submit" class="btn btn-primary">Save Student</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="modal fade" id="removeStudentModal" tabindex="-1" aria-labelledby="removeStudentModalLabel" aria-hidden="true">
           <div class="modal-dialog">
               <div class="modal-content">
                   <div class="modal-header">
                       <h5 class="modal-title" id="removeStudentModalLabel">Remove Student</h5>
                       <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                   </div>
                   <div class="modal-body">
                       <div class="mb-3">
                           <label for="removeStudentSelect" class="form-label">Select Student to Remove</label>
                           <select class="form-select" id="removeStudentSelect" style="width: 100%;">
                               <option value="">Select a student...</option>
                               {% for student in students %}
                                   <option value="{{ student.id }}">
                                       {{ student.first_name }} {{ student.last_name }} ({{ student.student_id }})
                                   </option>
                               {% endfor %}
                           </select>
                       </div>
                   </div>
                   <div class="modal-footer">
                       <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                       <button type="button" class="btn btn-danger" id="openConfirmModalBtn">Next</button>
                   </div>
               </div>
           </div>
       </div>

       <div class="modal fade" id="confirmRemoveModal" tabindex="-1" aria-labelledby="confirmRemoveModalLabel" aria-hidden="true">
           <div class="modal-dialog">
               <div class="modal-content">
                   <div class="modal-header">
                       <h5 class="modal-title" id="confirmRemoveModalLabel">Confirm Removal</h5>
                       <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                   </div>
                   <div class="modal-body">
                       <p>Are you sure you want to remove this student?</p>
                       <h4 class="text-center text-danger" id="studentNameToRemove"></h4>
                       <p class="text-center text-muted">This action cannot be undone.</p>
                   </div>
                   <div class="modal-footer">
                       <form action="{{ url_for('main.remove_student') }}" method="POST" class="w-100">
                           <input type="hidden" name="student_id" id="studentIdToRemove">

                           <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                           <button type="submit" class="btn btn-danger float-end">Yes, Remove Student</button>
                       </form>
                   </div>
               </div>
           </div>
       </div>

                <!-- Move Student Modal -->
        <div class="modal fade" id="moveStudentModal" tabindex="-1" aria-labelledby="moveStudentModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header" style="background-color: #003366; color: white;">
                <h5 class="modal-title" id="moveStudentModalLabel">Move Student</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <form action="{{ url_for('main.move_student') }}" method="POST">
                <div class="modal-body">
                    <p class="text-center text-muted mb-4">Select a student and choose a new trip.</p>

                    <!-- Student Dropdown -->
                    <div class="mb-3">
                    <label for="student_name" class="form-label">Select Student</label>
                    <select class="form-select" id="student_name" name="student_name" style="width: 100%;" required>
                        <option value="">Select a student...</option>
                        {% for student in students %}
                            <option value="{{ student.id }}">
                                {{ student.first_name }} {{ student.last_name }} ({{ student.student_id }})
                            </option>
                        {% endfor %}
                    </select>
                    </div>

                    <!-- Trip Dropdown -->
                    <div class="mb-3">
                    <label for="new_trip_id" class="form-label">Select New Trip</label>
                    <select class="form-select" id="new_trip_id" name="new_trip_id" required>
                        <option value="" disabled selected>Choose a trip...</option>
                        {% for trip in trips %}
                        <option value="{{ trip.id }}">{{ trip.trip_name }} ({{ trip.trip_type }})</option>
                        {% endfor %}
                    </select>
                    </div>
                </div>                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn text-white" style="background-color: #003366;">Confirm Move</button>
                </div>
                </form>
            </div>
            </div>
        </div>



        <!-- Swap Students Modal -->
        <div class="modal fade" id="swapStudentsModal" tabindex="-1" aria-labelledby="swapStudentsModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header" style="background-color: #003366; color: white;">
                <h5 class="modal-title" id="swapStudentsModalLabel">Swap Students</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <form action="{{ url_for('main.swap_students') }}" method="POST">
                <div class="modal-body">
                    <p class="text-center text-muted mb-4">Select two students to swap their trips.</p>

                    <div class="row align-items-center mb-4">
                    <!-- Student 1 -->
                    <div class="col-md-5">
                        <div class="bg-light p-4 rounded">
                        <label class="form-label fw-bold">Student 1</label>
                        <select class="form-select" id="student1_name" name="student1_name" style="width: 100%;" required>
                            <option value="">Select a student...</option>
                            {% for student in students %}
                                <option value="{{ student.id }}">
                                    {{ student.first_name }} {{ student.last_name }} ({{ student.student_id }})
                                </option>
                            {% endfor %}
                        </select>
                        </div>
                    </div>

                    <div class="col-md-2 text-center">
                        <div style="font-size: 40px; color: #005fa3;">â‡„</div>
                    </div>

                    <!-- Student 2 -->
                    <div class="col-md-5">
                        <div class="bg-light p-4 rounded">
                        <label class="form-label fw-bold">Student 2</label>
                        <select class="form-select" id="student2_name" name="student2_name" style="width: 100%;" required>
                            <option value="">Select a student...</option>
                            {% for student in students %}
                                <option value="{{ student.id }}">
                                    {{ student.first_name }} {{ student.last_name }} ({{ student.student_id }})
                                </option>
                            {% endfor %}
                        </select>
                        </div>
                    </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn text-white" style="background-color: #005fa3;">Confirm Swap</button>
                </div>
                </form>
            </div>
            </div>
        </div>


        <!-- Upload CSV Modal -->
        <div class="modal fade" id="uploadCSVModal" tabindex="-1" aria-labelledby="uploadCSVModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header" style="background-color:#003366;color:white;">
                <h5 class="modal-title" id="uploadCSVModalLabel">Upload CSV File</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form action="{{ url_for('main.upload_csv') }}" method="POST" enctype="multipart/form-data">
                <div class="modal-body">
                    <p class="text-center text-muted mb-4">
                    Upload a CSV file containing student and trip information.
                    </p>
                    <div class="mb-3">
                    <label for="csvFile" class="form-label">Choose CSV File</label>
                    <input class="form-control" type="file" id="csvFile" name="csv_file" accept=".csv" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn text-white" style="background-color:#003366;">Upload</button>
                </div>
                </form>
            </div>
            </div>
        </div>


        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/umd/simple-datatables.min.js" crossorigin="anonymous"></script>
        <script src="{{ url_for('static', filename='js/datatables-simple-demo.js') }}"></script>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
        <script src="{{ url_for('static', filename='js/first-years.js') }}"></script>
    </body>
</html>
